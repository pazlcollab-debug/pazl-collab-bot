# ‚úÖ –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—è TelegramID

**–î–∞—Ç–∞:** 2025-01-27  
**–ü—Ä–æ–±–ª–µ–º–∞:** –£—á–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—è `TelegramID` –≤ Airtable

---

## üîç –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è TelegramID

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—è –≤ Airtable:
- **–ò–º—è –ø–æ–ª—è:** `TelegramID` (—Å –∑–∞–≥–ª–∞–≤–Ω–æ–π I)
- **–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:** Number (—á–∏—Å–ª–æ) - —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é –≤ –∫–æ–¥–µ

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ TelegramID
**–§–∞–π–ª:** `services/airtable_api.py:398-407`

**–ë—ã–ª–æ:**
```python
airtable_data["TelegramID"] = str(data.get("telegram_id", ""))
```

**–°—Ç–∞–ª–æ:**
```python
# üÜî Telegram ID (–≤ Airtable —ç—Ç–æ Number, –ø–µ—Ä–µ–¥–∞–µ–º –∫–∞–∫ —á–∏—Å–ª–æ)
if "TelegramID" in available:
    telegram_id = data.get("telegram_id", "")
    if telegram_id:
        try:
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ, —Ç–∞–∫ –∫–∞–∫ –≤ Airtable –ø–æ–ª–µ Number
            airtable_data["TelegramID"] = int(telegram_id)
        except (ValueError, TypeError):
            # –ï—Å–ª–∏ –Ω–µ —á–∏—Å–ª–æ, –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É
            airtable_data["TelegramID"] = str(telegram_id)
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ï—Å–ª–∏ –ø–æ–ª–µ Number –≤ Airtable, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–∏—Å–ª–æ, –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É
- –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫

---

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á—Ç–µ–Ω–∏–µ TelegramID
**–§–∞–π–ª—ã:** `api/main.py:135`, `api/airtable_service.py:31`

**–ë—ã–ª–æ:**
```python
"telegram_id": str(fields.get("TelegramID", "")),
```

**–°—Ç–∞–ª–æ:**
```python
"telegram_id": str(fields.get("TelegramID", "")) if fields.get("TelegramID") is not None else "",
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ï—Å–ª–∏ –ø–æ–ª–µ Number, Airtable –≤–µ—Ä–Ω–µ—Ç —á–∏—Å–ª–æ (int), –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É
- `str()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —á–∏—Å–ª–æ –≤ —Å—Ç—Ä–æ–∫—É –¥–ª—è API –æ—Ç–≤–µ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None –¥–ª—è –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
**–§–∞–π–ª:** `handlers/form.py:73, 192`

**–ë—ã–ª–æ:**
```python
records = table.all(formula=match({"TelegramID": str(telegram_id)}))
```

**–°—Ç–∞–ª–æ:**
```python
# TelegramID –≤ Airtable - Number, –ø–µ—Ä–µ–¥–∞–µ–º –∫–∞–∫ —á–∏—Å–ª–æ
records = table.all(formula=match({"TelegramID": telegram_id}))
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- `match()` –∏–∑ pyairtable –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∏—Å–ª–∞
- –ü–µ—Ä–µ–¥–∞–µ–º —á–∏—Å–ª–æ –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫—É

---

### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö
**–§–∞–π–ª:** `api/main.py:88`

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```python
params = {"filterByFormula": f"{{TelegramID}}={telegram_id}"}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
- –§–æ—Ä–º—É–ª–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è Number —Ç–∏–ø–∞
- `telegram_id` –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –∏–∑ URL, –Ω–æ Airtable –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

1. **api/main.py:88** - –§–æ—Ä–º—É–ª–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ ‚úÖ
   ```python
   params = {"filterByFormula": f"{{TelegramID}}={telegram_id}"}
   ```

2. **api/main.py:135** - –ß—Ç–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ None ‚úÖ
   ```python
   "telegram_id": str(fields.get("TelegramID", "")) if fields.get("TelegramID") is not None else "",
   ```

3. **api/airtable_service.py:31** - –ß—Ç–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ None ‚úÖ
   ```python
   "telegram_id": str(fields.get("TelegramID", "")) if fields.get("TelegramID") is not None else "",
   ```

4. **services/airtable_api.py:398-407** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∫ —á–∏—Å–ª–æ ‚úÖ
   ```python
   airtable_data["TelegramID"] = int(telegram_id)
   ```

5. **handlers/form.py:73** - –ü–æ–∏—Å–∫ —Å —á–∏—Å–ª–æ–º ‚úÖ
   ```python
   records = table.all(formula=match({"TelegramID": telegram_id}))
   ```

6. **handlers/form.py:192** - –ü–æ–∏—Å–∫ —Å —á–∏—Å–ª–æ–º ‚úÖ
   ```python
   records = table.all(formula=match({"TelegramID": message.from_user.id}))
   ```

7. **services/status_notifier.py:99, 105, 137** - –ß—Ç–µ–Ω–∏–µ ‚úÖ
   ```python
   fields=["TelegramID", ...]
   fields.get("TelegramID")
   ```

8. **main.py:24, 36** - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö ‚úÖ
   ```python
   formula="AND({Status}='Approved', NOT({Notified}))"
   ```

---

## üîß –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ Airtable

### Number —Ç–∏–ø:
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: –ø–µ—Ä–µ–¥–∞–µ–º `int` –∏–ª–∏ `float`
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏: –ø–æ–ª—É—á–∞–µ–º `int` –∏–ª–∏ `float`
- –í —Ñ–æ—Ä–º—É–ª–∞—Ö: –±–µ–∑ –∫–∞–≤—ã—á–µ–∫ `{TelegramID}=123456`

### Text —Ç–∏–ø:
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: –ø–µ—Ä–µ–¥–∞–µ–º `str`
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏: –ø–æ–ª—É—á–∞–µ–º `str`
- –í —Ñ–æ—Ä–º—É–ª–∞—Ö: —Å –∫–∞–≤—ã—á–∫–∞–º–∏ `{TelegramID}='123456'`

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ TelegramID –∫–∞–∫ —á–∏—Å–ª–æ
- ‚úÖ –ß—Ç–µ–Ω–∏–µ TelegramID —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ None
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ TelegramID —Å —á–∏—Å–ª–æ–º
- ‚úÖ –§–æ—Ä–º—É–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

**–ü–æ–ª–µ `TelegramID` —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö!**

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã


